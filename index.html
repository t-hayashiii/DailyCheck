<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>日常チェックアプリ</title>

<!-- SortableJS（ドラッグ並び替え用） -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        padding: 20px;
        background: #f5f5f7;
        color: #333;
        max-width: 360px;
        margin: auto;
        font-size: 18px;
    }

    h1 {
        text-align: center;
        margin-bottom: 10px;
        font-weight: 600;
        font-size: 24px;
    }

    /* カウンター表示 */
    #counter {
        text-align: center;
        margin-bottom: 15px;
        font-size: 18px;
        font-weight: 600;
    }

    /* ------------------------
       スワイプ削除 UI
       ------------------------ */
    .item-wrapper {
        position: relative;
        overflow: hidden;
        margin-bottom: 12px;
        border-radius: 10px;
    }

    /* 削除ボタンエリア（後ろに隠れている） */
    .delete-area {
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 90px;
        background: #ff4d4d;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1; /* item より下 */
    }

    .deleteBtn {
        background: transparent;
        border: none;
        color: #fff;
        font-size: 16px;
        cursor: pointer;
    }

    /* スワイプで動くメイン部分 */
    .item {
        position: relative;
        z-index: 2; /* delete-area より上 */
        display: grid;
        grid-template-columns: 34px 1fr;
        align-items: center;
        background: #fff;
        padding: 14px 16px;
        border: 1px solid #e0e0e0;
        transition: transform 0.2s ease;
        font-size: 18px;
        border-radius: 10px;
    }

    .item.checked {
        background: #e9f7ec;
        border-color: #b6e2c2;
    }

    .item input[type="checkbox"] {
        width: 20px;
        height: 20px;
    }

    .textBox {
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .timestamp {
        color: #666;
        font-size: 14px;
        margin-top: 3px;
    }

    /* 新規追加エリア */
    #addBox {
        margin-top: 20px;
        display: flex;
        gap: 8px;
    }

    #newItemName {
        flex: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
    }

    #addItemBtn {
        padding: 10px 12px;
        border: none;
        background: #4a90e2;
        color: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
    }

    /* 全チェック解除 */
    #clearAllBtn {
        width: 100%;
        margin-top: 25px;
        padding: 12px 0;
        border: none;
        background: #bbb;
        color: #fff;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
    }

    /* 並び替えドラッグ中の透明化 */
    .drag-ghost {
        opacity: 0.4;
    }
</style>
</head>

<body>

<h1>日常チェックアプリ</h1>

<div id="counter"></div>

<div id="items"></div>

<div id="addBox">
    <input type="text" id="newItemName" placeholder="新しい項目名を追加">
    <button id="addItemBtn" onclick="addItem()">追加</button>
</div>

<button id="clearAllBtn" onclick="clearAllChecks()">全てのチェックをオフにする</button>

<script>
    const storageKey = "dailyCheckItems";

    const defaultItems = [
        { name: "鍵の施錠", checked: false, timestamp: "" },
        { name: "窓の施錠", checked: false, timestamp: "" },
        { name: "部屋の消灯", checked: false, timestamp: "" }
    ];

    /* -------------------
       データ操作
       ------------------- */
    function loadItems() {
        const saved = localStorage.getItem(storageKey);
        return saved ? JSON.parse(saved) : defaultItems;
    }

    function saveItems(items) {
        localStorage.setItem(storageKey, JSON.stringify(items));
    }

    function getNowText() {
        const now = new Date();
        const youbi = ["日","月","火","水","木","金","土"][now.getDay()];
        return `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,"0")}-${String(now.getDate()).padStart(2,"0")} (${youbi}) `
             + `${String(now.getHours()).padStart(2,"0")}:${String(now.getMinutes()).padStart(2,"0")}`;
    }

    /* -------------------
       カウンター更新
       ------------------- */
    function updateCounter() {
        const items = loadItems();
        const total = items.length;
        const done = items.filter(i => i.checked).length;

        document.getElementById("counter").textContent =
            `チェック済：${done} / ${total}　（残り：${total - done}）`;
    }

    /* -------------------
       描画
       ------------------- */
    function render() {
        const items = loadItems();
        const container = document.getElementById("items");
        container.innerHTML = "";

        items.forEach((item, idx) => {
            const wrapper = document.createElement("div");
            wrapper.className = "item-wrapper";

            /* 削除ボタン（後ろに隠す） */
            const deleteArea = document.createElement("div");
            deleteArea.className = "delete-area";

            const delBtn = document.createElement("button");
            delBtn.className = "deleteBtn";
            delBtn.textContent = "削除";
            delBtn.onclick = () => deleteItem(idx);

            deleteArea.appendChild(delBtn);

            /* メインアイテム */
            const div = document.createElement("div");
            div.className = "item";
            if (item.checked) div.classList.add("checked");

            /* -------- スワイプ処理 -------- */
            let startX = 0;
            let currentX = 0;
            let isDragging = false;

            div.addEventListener("touchstart", e => {
                startX = e.touches[0].clientX;
                isDragging = true;
            });

            div.addEventListener("touchmove", e => {
                if (!isDragging) return;
                currentX = e.touches[0].clientX;
                const delta = currentX - startX;

                if (delta < 0) {
                    div.style.transform = `translateX(${delta}px)`;
                }
            });

            div.addEventListener("touchend", () => {
                isDragging = false;

                if (currentX - startX < -60) {
                    div.style.transform = "translateX(-90px)";
                } else {
                    div.style.transform = "translateX(0)";
                }
            });

            /* チェックボックス */
            const cb = document.createElement("input");
            cb.type = "checkbox";
            cb.checked = item.checked;
            cb.onchange = () => toggleCheck(idx);

            /* テキスト部分 */
            const textBox = document.createElement("div");
            textBox.className = "textBox";

            const label = document.createElement("div");
            label.textContent = item.name;

            const ts = document.createElement("span");
            ts.className = "timestamp";
            ts.textContent = item.timestamp || "";

            textBox.appendChild(label);
            textBox.appendChild(ts);

            /* 要素配置 */
            div.appendChild(cb);
            div.appendChild(textBox);

            wrapper.appendChild(deleteArea);
            wrapper.appendChild(div);

            container.appendChild(wrapper);
        });

        updateCounter();
    }

    /* -------------------
       操作
       ------------------- */
    function toggleCheck(index) {
        const items = loadItems();
        const item = items[index];

        item.checked = !item.checked;
        item.timestamp = item.checked ? getNowText() : "";

        saveItems(items);
        render();
        initSortable();
    }

    function addItem() {
        const name = document.getElementById("newItemName").value.trim();
        if (!name) return;

        const items = loadItems();
        items.push({ name, checked: false, timestamp: "" });

        saveItems(items);
        document.getElementById("newItemName").value = "";
        render();
        initSortable();
    }

    function deleteItem(index) {
        const items = loadItems();
        items.splice(index, 1);
        saveItems(items);
        render();
        initSortable();
    }

    function clearAllChecks() {
        const items = loadItems();
        items.forEach(i => {
            i.checked = false;
            i.timestamp = "";
        });

        saveItems(items);
        render();
        initSortable();
    }

    /* -------------------
       並び替え（Sortable）
       ------------------- */
    function initSortable() {
        const container = document.getElementById("items");

        if (container._sortable) container._sortable.destroy();

        container._sortable = Sortable.create(container, {
            animation: 150,
            ghostClass: "drag-ghost",
            forceFallback: true,
            fallbackTolerance: 3,
            onEnd: function (evt) {
                const items = loadItems();
                const moved = items.splice(evt.oldIndex, 1)[0];
                items.splice(evt.newIndex, 0, moved);
                saveItems(items);

                render();
                initSortable();
            }
        });
    }

    /* -------------------
       初期実行
       ------------------- */
    render();
    initSortable();
</script>

</body>
</html>
